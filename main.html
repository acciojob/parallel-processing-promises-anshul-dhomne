<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Parallel Image Downloader (Promise.all)</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 20px; }
    #output img { max-width: 150px; margin: 8px; border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.15); }
    #controls { margin-top: 12px; }
    #error { color: #b00020; margin-top: 10px; font-weight: 600; }
    /* simple spinner */
    #loading { display: none; margin-top: 10px; }
    .spinner {
      width: 36px; height: 36px; border-radius: 50%;
      border: 4px solid rgba(0,0,0,0.12); border-top-color: #0b84ff;
      animation: spin 1s linear infinite;
      display: inline-block; vertical-align: middle;
    }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <h2>Parallel Image Downloader (Promise.all)</h2>

  <div id="controls">
    <button id="start">Start download</button>
    <button id="clear">Clear</button>
  </div>

  <div id="loading" aria-live="polite" role="status">
    <span class="spinner" aria-hidden="true"></span>
    <span style="margin-left:8px;">Downloading imagesâ€¦</span>
  </div>

  <div id="error" role="alert" aria-live="assertive"></div>

  <div id="output" style="margin-top:12px; display:flex; flex-wrap:wrap;"></div>

  <script>
    // Example image URLs. Replace these with your actual URLs.
    const imageUrls = [
      'https://picsum.photos/id/237/400/300',
      'https://picsum.photos/id/238/400/300',
      'https://picsum.photos/id/239/400/300'
      // add or remove URLs as needed
    ];

    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const outputEl = document.getElementById('output');
    const startBtn = document.getElementById('start');
    const clearBtn = document.getElementById('clear');

    // Returns a promise that resolves with an <img> element when loaded,
    // or rejects with a descriptive error message on failure.
    function downloadImage(url, timeoutMs = 10000) {
      return new Promise((resolve, reject) => {
        const img = new Image();

        let timedOut = false;
        const to = setTimeout(() => {
          timedOut = true;
          img.src = ''; // stop loading (best-effort)
          reject(new Error(`Timeout while loading image: ${url}`));
        }, timeoutMs);

        img.onload = () => {
          if (timedOut) return;
          clearTimeout(to);
          resolve(img);
        };

        img.onerror = (ev) => {
          if (timedOut) return;
          clearTimeout(to);
          reject(new Error(`Failed to load image: ${url}`));
        };

        // start loading
        img.src = url;
        // optional: set alt so screen readers have something
        img.alt = 'Downloaded image';
      });
    }

    // Main function: downloads all images in parallel and updates the DOM.
    function downloadImages(urls) {
      // reset UI
      errorEl.textContent = '';
      outputEl.innerHTML = '';
      loadingEl.style.display = 'block';
      startBtn.disabled = true;
      clearBtn.disabled = true;

      // create an array of promises
      const promises = urls.map(url => downloadImage(url));

      // Wait for all to either resolve or reject (Promise.all will reject on first failure)
      return Promise.all(promises)
        .then(images => {
          // hide loading, display images
          loadingEl.style.display = 'none';
          images.forEach(img => {
            // optionally set some display attributes
            img.width = 180;
            img.height = Math.round(180 * (img.naturalHeight / img.naturalWidth));
            img.style.objectFit = 'cover';
            outputEl.appendChild(img);
          });
        })
        .catch(err => {
          // hide loading, show error message
          loadingEl.style.display = 'none';
          errorEl.textContent = String(err && err.message ? err.message : err);
        })
        .finally(() => {
          startBtn.disabled = false;
          clearBtn.disabled = false;
        });
    }

    // Button wiring
    startBtn.addEventListener('click', () => {
      // run with the list of URLs
      downloadImages(imageUrls);
    });

    clearBtn.addEventListener('click', () => {
      errorEl.textContent = '';
      outputEl.innerHTML = '';
      loadingEl.style.display = 'none';
    });

    // optional: auto-start on load
    // document.addEventListener('DOMContentLoaded', () => downloadImages(imageUrls));
  </script>
</body>
</html>
